<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Document</title>
		<link href="/main.css" rel="stylesheet" />
	</head>
	<body class="grey-bg">
        <%- include ('nav.ejs') %>
		<!-- <%= JSON.stringify(posts) %> -->
		<div class="white-bg">
			<% for (let i=0; i<posts.length; i++) { %>
			<div class="list-box">
				<h4><a href="/detail/<%= posts[i]._id %>"><%= posts[i].title %></a></h4>
                <div class="edit-button"><a href ="/edit/<%= posts[i]._id %>"><button>Edit</button></a></div>
                <span class="delete" data-id="<%= posts[i]._id %>">ğŸ—‘ï¸</span>

				<p><%= posts[i].content %></p>
			</div>
			<% } %>
		</div>

		<% if (posts.length >= 5) { %>
			<a href="/list/next/<%= posts[posts.length-1]._id %>">Next</a>
		<% } %>
		
		 

<script>
    document.querySelectorAll('.delete').forEach((item) => { // delete í´ë˜ìŠ¤ë¥¼ ê°€ì§„ ëª¨ë“  ìš”ì†Œë¥¼ ì°¾ì•„ì„œ forEachë¡œ ë°˜ë³µí•œë‹¤.
    item.addEventListener('click', (e) => {
        const id = e.target.getAttribute('data-id'); // idëŠ” .deleteê°€ í´ë˜ìŠ¤ì¸ ìŠ¤íŒ¬ì˜ data-idì¸ë°, data-ëŠ” ìƒëµí•˜ê³  idë§Œ ê°€ì ¸ì˜¨ë‹¤.
        fetch(`/delete/${id}`, {
            method: 'DELETE', // delete ë©”ì†Œë“œë¥¼ ì‚¬ìš©í•œë‹¤. bodyì™€ headersëŠ” í•„ìš”ì—†ë‹¤. 
        })
        .then((res) => res.json()) // ê·¸ë¦¬ê³  deleteê°€ ì„±ê³µí•˜ë©´ jsonìœ¼ë¡œ ë³€í™˜í•œë‹¤.
        .then((data) => {
            if (data.success) {
                window.location.reload();
            } // ê·¸ë¦¬ê³  ì„±ê³µí•˜ë©´ í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•œë‹¤.
        })
		.then(console.log(id));
    });
});



    </script>  
	</body>
</html>
